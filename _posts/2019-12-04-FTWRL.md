---
layout: post
title: 如何减少备份时的FTWRL对业务的影响
date: 2019-12-04
categories: blog
tags: [mysqlbackup,FTWRL,备份与恢复,]
description: 
---

mysql 5.6/5.7的日常全部我们通常采用xtrabackup/mysqlbackup等工具来进行物理备份，在备份快要结束的时候，为了获得一个一致性备份点，备份工具通常会下发一个一个FTWRL全局读锁, 从这段时间到下发`unlock tables`释放全局读锁之前整个数据库是只读的，如果整个实例中非事务表（Non-Innodb）的数量很小，通常情况下这段时间足够短暂，但是笔者曾经遇到过因为下发FTWRL无法成功导致业务被短暂hang住的情况

可能觉得好奇的是，通常我们为了减少备份对数据库的影响，备份通常都会在从库进行，但由于公司的MySQL一直以来采用RHCS集群架构，类似于将MySQL当做Oracle来用，底层数据只保留一份，通过红帽集群套件来实现MySQL的高可用。


在慢日志中可以看到如下sql:





演示案列





